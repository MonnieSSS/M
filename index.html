<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æŠ½çï¼ˆä½ çš„åå–®å·²å…§å»º / CodePen ç©©å®šç‰ˆï¼‰</title>
<style>
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Helvetica Neue",Arial,"Microsoft JhengHei",sans-serif;background:#fafafa;color:#222}
  main{max-width:900px;margin:0 auto;padding:14px;display:grid;gap:12px}
  .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:14px}
  textarea{width:100%;min-height:160px;font-family:ui-monospace,Menlo,Consolas,"Courier New",monospace;font-size:15px}
  input[type=number]{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;font-size:16px}
  .btns{display:flex;flex-wrap:wrap;gap:8px}
  button{padding:10px 14px;border:1px solid #ddd;border-radius:10px;background:#f4f4f4;cursor:pointer}
  button.primary{background:#111;color:#fff;border-color:#111}
  .muted{color:#666;font-size:13px}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#f0f0f0;font-size:12px;margin-left:6px}
  ol{margin:0;padding-left:22px}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid #eee;padding:6px 4px;text-align:left;font-size:14px}
  .ok{color:#067d3b}.error{color:#b42318}
</style>
</head>
<body>
<main>
  <div class="card">
    <h2>ğŸ åŠ æ¬Šéš¨æ©ŸæŠ½çï¼ˆé€ä¸€æ­æ›‰ï¼Œä¸é‡è¤‡ï¼‰</h2>
    <textarea id="entries">Chintsung,5
Ejen,10
Emma & Family,15
fafachu,20
Fio L,1
Fuyi Lo,3
Izzy Kuo,5
Jack Liu,7
Kai Lee,9
Kimmy,12
Miki,15
Ming,18
Miriam chen,25
Sally,8
Sophia Wang,30
Vivian,6
Winny,3
Zoe Yang,5
Monnie,1
Alice,9</textarea>
    <div style="display:grid;gap:12px;grid-template-columns:1fr 1fr">
      <div class="card" style="padding:10px">
        <label for="count"><strong>æŠ½å‡ºäººæ•¸ï¼ˆæ¯æ¬¡æŠ½ä¸€ä½ï¼Œä¸é‡è¤‡ï¼‰</strong></label>
        <input id="count" type="number" min="1" step="1" value="4" inputmode="numeric">
        <div class="muted">ä¸Šé™æœƒè‡ªå‹•é™åˆ¶åˆ°æœ‰æ•ˆåƒè³½è€…æ•¸ã€‚</div>
      </div>
      <div class="card" style="padding:10px">
        <div><strong>æ“ä½œæµç¨‹</strong></div>
        <div class="muted">æŒ‰ã€Œé–‹å§‹æ–°ä¸€è¼ªã€â†’ æŒ‰ã€ŒæŠ½ä¸‹ä¸€ä½ã€é‡è¤‡ç›´åˆ°æŠ½æ»¿ï¼›æˆ–ç”¨ã€Œä¸€æ¬¡æŠ½å®Œã€ã€‚</div>
      </div>
    </div>
    <div class="btns">
      <button class="primary" id="startBtn" type="button">é–‹å§‹æ–°ä¸€è¼ª</button>
      <button id="drawOneBtn" type="button" disabled>æŠ½ä¸‹ä¸€ä½</button>
      <button id="drawAllBtn" type="button" disabled>ä¸€æ¬¡æŠ½å®Œ</button>
      <button id="resetBtn" type="button" disabled>é‡ç½®</button>
      <button id="copyBtn" type="button">è¤‡è£½çµæœ</button>
      <span class="muted" id="status" role="status" aria-live="polite"></span>
    </div>
  </div>

  <div class="card">
    <strong>å³æ™‚é è¦½</strong>
    <div id="previewInfo" class="muted"></div>
    <div style="overflow:auto">
      <table>
        <thead><tr><th>å§“å</th><th>ç¥¨æ•¸</th></tr></thead>
        <tbody id="previewBody"></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
      <strong>æŠ½ççµæœ</strong>
      <span id="summary" class="muted"></span>
    </div>
    <ol id="resultList"><li class="muted">å°šæœªæŠ½å‡ºï¼ŒæŒ‰ã€Œé–‹å§‹æ–°ä¸€è¼ªã€â†’ã€ŒæŠ½ä¸‹ä¸€ä½ã€ã€‚</li></ol>
  </div>
</main>

<script>
/* æ”¾åœ¨ body å°¾ç«¯ï¼Œç¢ºä¿ DOM å·²å­˜åœ¨ï¼ˆCodePen æœ€ç©©ï¼‰ */
(function(){
  function $(id){ return document.getElementById(id); }
  var entriesEl=$("entries"), countEl=$("count");
  var startBtn=$("startBtn"), drawOneBtn=$("drawOneBtn"), drawAllBtn=$("drawAllBtn"), resetBtn=$("resetBtn"), copyBtn=$("copyBtn");
  var statusEl=$("status"), summaryEl=$("summary"), resultList=$("resultList");
  var previewBody=$("previewBody"), previewInfo=$("previewInfo");

  // è§£æï¼šåƒã€Œåå­—,æ•¸å­—ã€æœ€ç©©ï¼ˆä½ çµ¦çš„åå–®å·²æ˜¯é€™ç¨®æ ¼å¼ï¼‰
  function parseEntries(text){
    var lines=String(text||"").split(/\r?\n/), seen=Object.create(null);
    for (var i=0;i<lines.length;i++){
      var line=lines[i].trim(); if (!line) continue;
      var parts=line.split(",");
      var name=parts[0]?parts[0].trim():"";
      var num=parts[1]?Number(String(parts[1]).replace(/[^\d.-]/g,"")):NaN;
      if (!name || !isFinite(num) || num<=0) continue;
      if (!seen[name]) seen[name]=0;
      seen[name]+=num;
    }
    var list=[]; for (var k in seen) list.push({name:k, tickets:Math.floor(seen[k])});
    return list;
  }

  function updatePreview(){
    var data=parseEntries(entriesEl.value);
    previewBody.innerHTML=""; var total=0;
    for (var i=0;i<data.length;i++){
      var tr=document.createElement('tr');
      tr.innerHTML="<td>"+data[i].name+"</td><td>"+data[i].tickets+"</td>";
      previewBody.appendChild(tr); total+=data[i].tickets;
    }
    previewInfo.textContent = data.length ? ("å…± "+data.length+" äººï¼Œç¸½ç¥¨æ•¸ "+total) : "æœªè§£æå‡ºåå–®";
    return data;
  }

  function weightedPick(items){
    var total=0; for (var i=0;i<items.length;i++) total+=items[i].tickets;
    var r=Math.random()*total;
    for (var j=0;j<items.length;j++){ if (r<items[j].tickets) return items[j]; r-=items[j].tickets; }
    return items[items.length-1];
  }

  var session=null;
  function setControls(active){ drawOneBtn.disabled=!active; drawAllBtn.disabled=!active; resetBtn.disabled=!active; }
  function updateSummary(){
    if (!session){ summaryEl.textContent=""; return; }
    var total=0; for (var i=0;i<session.entrants.length;i++) total+=session.entrants[i].tickets;
    summaryEl.textContent="å…± "+session.entrants.length+" äººã€"+total+" ç¥¨ï¼›å·²æ­æ›‰ "+session.winners.length+" ä½ã€‚";
  }
  function renderWinners(){
    resultList.innerHTML="";
    if (!session || !session.winners.length){ resultList.innerHTML='<li class="muted">å°šæœªæŠ½å‡º</li>'; return; }
    for (var i=0;i<session.winners.length;i++){
      var w=session.winners[i], li=document.createElement('li');
      li.innerHTML=(i+1)+". "+w.name+' <span class="pill">'+w.tickets+'ç¥¨</span>';
      resultList.appendChild(li);
    }
    resultList.scrollIntoView({behavior:"smooth"});
  }

  function startRound(){
    var entrants=updatePreview();
    if (!entrants.length){ statusEl.textContent="è«‹å…ˆè¼¸å…¥æ­£ç¢ºçš„åå–®èˆ‡ç¥¨æ•¸ã€‚"; return; }
    var count=Math.max(1, Math.floor(Number(countEl.value)||1));
    if (count>entrants.length) count=entrants.length;
    countEl.value=String(count);
    session={entrants:entrants.slice(), remaining:entrants.slice(), count:count, winners:[]};
    statusEl.textContent="æ–°ä¸€è¼ªé–‹å§‹ã€‚æŒ‰ã€ŒæŠ½ä¸‹ä¸€ä½ã€ã€‚";
    setControls(true); renderWinners(); updateSummary();
  }
  function drawOne(){
    if (!session){ startRound(); return; }
    if (session.winners.length>=session.count){ statusEl.textContent="å·²é”è¨­å®šäººæ•¸ã€‚"; setControls(false); return; }
    if (!session.remaining.length){ statusEl.textContent="æ²’æœ‰å¯æŠ½åå–®ã€‚"; setControls(false); return; }
    var pick=weightedPick(session.remaining);
    for (var i=0;i<session.remaining.length;i++){ if (session.remaining[i].name===pick.name){ session.remaining.splice(i,1); break; } }
    session.winners.push(pick); statusEl.textContent='æŠ½å‡ºï¼šã€Œ'+pick.name+'ã€'; renderWinners(); updateSummary();
    if (session.winners.length>=session.count){ statusEl.textContent+='ï¼ˆå®Œæˆï¼‰'; setControls(false); }
  }
  function drawAll(){ if (!session) startRound(); while(session && session.winners.length<session.count) drawOne(); }
  function resetRound(){ session=null; setControls(false); resultList.innerHTML='<li class="muted">å°šæœªæŠ½å‡º</li>'; summaryEl.textContent=""; statusEl.textContent="æœ¬è¼ªå·²é‡ç½®ã€‚"; }
  function copyResults(){
    if (!session || !session.winners.length){ statusEl.textContent="å°šç„¡çµæœå¯è¤‡è£½ã€‚"; return; }
    var lines=session.winners.map(function(w,i){return (i+1)+". "+w.name+"ï¼ˆç¥¨æ•¸ "+w.tickets+"ï¼‰";}).join("\n");
    var ta=document.createElement('textarea'); ta.value=lines; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); statusEl.textContent='çµæœå·²è¤‡è£½ã€‚'; }catch(e){ statusEl.textContent='è«‹æ‰‹å‹•è¤‡è£½ã€‚'; }
    document.body.removeChild(ta);
  }

  // ç¶å®šäº‹ä»¶
  entriesEl.addEventListener('input', updatePreview);
  startBtn.addEventListener('click', startRound);
  drawOneBtn.addEventListener('click', drawOne);
  drawAllBtn.addEventListener('click', drawAll);
  resetBtn.addEventListener('click', resetRound);
  copyBtn.addEventListener('click', copyResults);

  // é¦–æ¬¡é è¦½
  updatePreview();
})();
</script>
</body>
</html>
